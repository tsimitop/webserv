<!DOCTYPE html>
<html>
<head>
	<title>Webserv</title>
	<link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>

<h1>The simplest index ever</h1>
<p>Is this a simple index or what?</p>

<input type="file" id="myFile">
<button onclick="uploadFile()">Upload</button>

<br><br>

<input type="text" id="filenameToDelete" placeholder="Enter filename to delete">
<button onclick="deleteFile()">Delete</button>

<br><br>

<h2>CGI</h2>

<button onclick="tryCGI('../cgi/hello.py')">Try working CGI</button><br><br>
<button onclick="tryCGI('../cgi/loop.py')">Try endless CGI</button><br><br>
<button onclick="tryCGI('../cgi/hell.py')">Try non-existing CGI</button><br><br>
<button onclick="tryCGI('../cgi/mistake.py')">Try wrong CGI</button><br><br>
<input type="text" id="nameOfUser" placeholder="Enter your name">
<button onclick="tryCGIpost('../cgi/for_post.py')">Try post CGI</button><br><br>

<script>
	function uploadFile() {
		const fileInput = document.getElementById("myFile");
		const file = fileInput.files[0];

		if (!file) {
			alert("Please select a file");
			return;
		}

		const filename = file.name;

		fetch('/uploads', {
			method: "POST",
			headers: {
				"Content-Type": "application/octet-stream",
				"Content-Disposition": 'attachment; filename="' + filename + '"',
			},
			body: file // Send the raw file
		}).then(response => console.log("Upload complete"))
		  .catch(error => console.error("Error:", error));
	}
</script>

<script>
	function deleteFile() {
		const filenameInput = document.getElementById("filenameToDelete");
		
		if (!filenameInput || !filenameInput.value) {
			alert("Please enter a filename to delete.");
			return;
		}

		const filename = filenameInput.value;

		fetch('/uploads/' + encodeURIComponent(filename), {
			method: "DELETE"
		})
		.then(response => {
			if(response.ok) {
				console.log ("Deleted: " + filename);
			} else {
				console.error("Failed to delete: " + filename);
			}
		})
		.catch(error => console.error("Error: ", error));
	}
</script>

<script>
	function tryCGI(location) {
	fetch(location)
		.then(response => response.text())
		.then(data => {
			history.pushState(data, '', location);
			document.open();
			document.write(data);
			document.close();
			window.addEventListener('popstate', () => {
				window.location.href = '/index.html';
			});
		})
		.catch(error => {
			console.error("Error:", error);
		});
	}
</script>

<script>
	function tryCGIpost(location) {
		const name = document.getElementById("nameOfUser").value;
		const data = `name=${encodeURIComponent(name)}`;

	fetch(location, {
		method: "POST",
		headers: {
			"Content-Type": "application/x-www-form-urlencoded"
		},
		body: data
	})
		.then(response => response.text())
		.then(data => {
			history.pushState(null, '', location);
			document.open();
			document.write(data);
			document.close();
			window.addEventListener('popstate', () => {
				window.location.href = '/index.html';
			});
		})
		.catch(error => {
		  console.error("Error:", error);
		});
	}
</script>

</body>
</html>